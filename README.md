## 1. ç¯å¢ƒ

ğŸŸ§å»ºè®®ä½¿ç”¨ anacondaï¼Œç¡®ä¿anacondaå®‰è£…æ–‡ä»¶å¤¹è·¯å¾„ä¸å«**ä¸­æ–‡&ç©ºæ ¼**ä»¥åŠé¡¹ç›®æ–‡ä»¶å¤¹è·¯å¾„ä¸å«**ä¸­æ–‡&ç©ºæ ¼**åï¼Œ**ä¾æ¬¡**æ‰§è¡Œ

```
conda create -n ML python==3.10
conda activate ML
```

ğŸŸ¦éƒ¨åˆ†ç”¨æˆ·åœ¨æ‰§è¡Œ `conda activate ML` æ—¶å€™ä¼šå‡ºç°éœ€è¦`conda init` çš„æç¤ºï¼Œæ­¤æ—¶è¯·ä½¿ç”¨å¦‚ä¸‹ç±»ä¼¼å‘½ä»¤

* `conda init --all`
* `conda init cmd.exe`

ğŸŸ¨ç„¶åï¼Œç»ˆç«¯ä½¿ç”¨ `cd` å‘½ä»¤åˆ‡æ¢å·¥ä½œæ–‡ä»¶å¤¹è‡³å·¥ä½œç›®å½•ï¼Œ ä¸‹è½½ python æ‰€éœ€çš„ä¾èµ–åº“

```
pip install -r requirements.txt
```

> è¯·ç¡®ä¿é¡¹ç›®æ–‡ä»¶å¤¹æ‰€åœ¨ç£ç›˜å†…å­˜è¶³å¤Ÿ


---


## 2. é¡¹ç›®ä»‹ç»



### 2.1 é¡¹ç›®ç›®æ ‡

ğŸŸ§æœ¬é¡¹ç›®å— [è®ºæ–‡](https://arxiv.org/abs/2303.03630) å¯å‘ï¼Œåœ¨ cifar100 æ•°æ®é›†ä¸Šæ¯”è¾ƒä»¥ä¸‹æ¨¡å‹çš„è¡¨ç°æ•ˆæœ

* ç®€å•æ–¹æ³•
  * CE & BSCE
* å‰äººçš„æ”¹è¿›æ–¹æ³•
  * LDAM & LADE & MiSLAS & RIDE & Paco
* è®ºæ–‡ä½œè€…æå‡ºçš„ GML tuning ç­–ç•¥ä»¥åŠ ensemble trickæ–¹æ³•
  * CE + GML & CE + GML(emsemble)

> ç”±äºå›¢é˜Ÿç§‘ç ”èƒ½åŠ›æœ‰é™ï¼Œåªèƒ½å¯¹åŸºäºåŸºç¡€çš„æ®‹å·®ç¥ç»ç½‘ç»œæ¶æ„æ–¹æ³•è¿›è¡Œå†ç°ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨ç®€å•çš„ CE æ–¹æ³•æ¥å†ç°è®ºæ–‡æå‡ºçš„ GML æŸå¤±å‡½æ•°çš„ Plug-In Method å¯¹äºé¢„è®­ç»ƒæ¨¡å‹çš„æ”¹å–„æ•ˆæœ



### 2.2 æ–‡ä»¶ä»‹ç»

**Paco**, **RIDE-LongTailRecgnition** : è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å­˜å‚¨çš„æ˜¯å¯¹åº”æ¨¡å‹çš„ä»£ç  (ç”±äºè¿™ä¸ªå¹¶éæˆ‘ä»¬é¡¹ç›®çš„ä¸»ä½“æ–‡ä»¶ï¼Œä¸åšè¿‡å¤šä»‹ç»)

```
- app.py : é¡¹ç›®çš„ä¸»ä½“å…¥å£ï¼Œè¿è¡Œè¯¥æ–‡ä»¶å¯ä»¥è¿›å…¥ webui ç•Œé¢
- train.py : è®­ç»ƒæ¨¡å‹ & æµ‹è¯•æ¨¡å‹
- requirements.txt : Python ä¾èµ–
- utils.py : å­˜å‚¨ç»Ÿè®¡æ¨¡å‹è¯„ä»· metric çš„å‡½æ•°
- loss.py : å­˜å‚¨å„ç§éœ€è¦ç”¨åˆ°çš„æŸå¤±å‡½æ•°
- models : 
	- pretrained : é¢„è®­ç»ƒæ¨¡å‹
	- resnet.py : å­˜å‚¨æ®‹å·®ç¥ç»ç½‘ç»œä»£ç 
- datasets :
	- dataset.py : ä¸‹è½½ cifar10/cifar100ï¼Œå¹¶å¤„ç†ä¸ºä¸å¹³è¡¡çš„æ•°æ®é›†
	- sampler.py : é™„åŠ çš„åŠŸèƒ½ï¼Œæä¾›äº†å¦å¤–ä¸€äº› Long-tail learning çš„æ–¹æ³•
- Trained_Model : å­˜å‚¨è®­ç»ƒåæ¨¡å‹çš„æ–‡ä»¶å¤¹
```




### 2.3 ä½¿ç”¨è¯´æ˜

> ç»æµ‹è¯•ï¼Œæˆ‘ä»¬çš„ä»£ç æ—¢å¯ä»¥å•ç‹¬åœ¨ cpu ä¸Šè¿è¡Œï¼Œä¹Ÿå¯ä»¥å•ç‹¬åœ¨ gpu ä¸Šè¿è¡Œ

ğŸŸ¨æˆ‘ä»¬å€Ÿç”± UI ç•Œé¢ï¼Œä»‹ç»å…·ä½“çš„ä½¿ç”¨ç»†èŠ‚ï¼Œä½¿ç”¨ç»ˆç«¯ `python app.py` or IDE è¿è¡Œ app.py æ–‡ä»¶ï¼Œç„¶åç‚¹å‡»å¼¹å‡ºçš„ç½‘å€ã€‚



ğŸŸ¦ç½‘é¡µä¸Šä¼šæ˜¾ç¤º3ä¸ªtabï¼Œè®­ç»ƒï¼Œæ¨ç†ï¼Œæ¯”è¾ƒï¼Œæ¥ä¸‹æ¥ä»‹ç»ä¸€ä¸‹ä¸‰ä¸ªé¡µé¢

#### (1).  è®­ç»ƒ



ğŸŒˆ**æ•°æ®é›†**

| å‚æ•°             | ä½œç”¨                                                      |
| ---------------- | --------------------------------------------------------- |
| Dataset          | è®­ç»ƒä½¿ç”¨çš„æ•°æ®é›†                                          |
| Imbalance Factor | #æ‰€å«æ ·æœ¬æœ€å°‘çš„ç±»åˆ«çš„æ ·æœ¬æ•° / #æ‰€å«æ ·æœ¬æœ€å¤šçš„ç±»åˆ«çš„æ ·æœ¬æ•° |
| Data Path        | å­˜å‚¨æ•°æ®é›†çš„ä½ç½®ï¼Œä¸å»ºè®®ä¿®æ”¹é»˜è®¤å€¼                        |



ğŸŒˆ**IFå€¼ & re-weight_re-sampleç­–ç•¥** 

| å‚æ•°           | ä½œç”¨                                                   |
| -------------- | ------------------------------------------------------ |
| Imbalance Type | å°†å¹³è¡¡çš„cifar-10/cifar-100æ‰“ä¹±ä¸ºä¸å¹³è¡¡æ•°æ®é›†çš„æ–¹å¼     |
| Train Rule     | å¦å¤–çš„ä¸€äº›é•¿å°¾å­¦ä¹ çš„æ–¹æ³•ï¼Œå¦‚ re-weighting, re-sampling |



ğŸŒˆ**é¢„è®­ç»ƒ & é›†æˆæ¨¡å‹å‚æ•°è®¾ç½®**

| å‚æ•°                                    | ä½œç”¨                                                      |
| --------------------------------------- | --------------------------------------------------------- |
| Pretrained(Freezing feature extraction) | ç¡®è®¤æ˜¯å¦ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œä½†æ˜¯ä»…å†»ç»“å…¶ç‰¹å¾æå–ç½‘ç»œ          |
| Pretrained(Freezing all parameters)     | ç¡®è®¤æ˜¯å¦ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼Œä½†æ˜¯å†»ç»“å…¶æ‰€æœ‰å‚æ•°                |
| Ensemble                                | ç¡®è®¤æ˜¯å¦é‡‡å–ä½œè€…æå‡ºçš„ ensemble çš„ trick                  |
| Select Pretrained Model                 | ä» â€./models/pretrainedâ€œ æ–‡ä»¶å¤¹ä¸‹è·å–å½“å‰å·²æœ‰çš„é¢„è®­ç»ƒæ¨¡å‹ |
| Temperature for New Model               | ä½œè€…æå‡ºçš„ ensemble trick çš„ t1 å‚æ•°                      |
| Temperature for Old Model               | ä½œè€…æå‡ºçš„ ensemnle trick çš„ t2 å‚æ•°                      |



ğŸŒˆ**å…¶ä»–å‚æ•°**

| å‚æ•°              | ä½œç”¨                                                     |
| ----------------- | -------------------------------------------------------- |
| Seed              | ç”¨äºè®¾ç½®éšæœºæ•°ç§å­(seed)ä»¥ç¡®ä¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„éšæœºæ€§å¯é‡ç° |
| Root Log          | ä¿å­˜è®­ç»ƒè¿‡ç¨‹çš„æ—¥å¿—                                       |
| Experiment String | è¡¨ç¤ºå½“å‰è¯•éªŒçš„ç¼–å·                                       |



ğŸŒˆ**è®­ç»ƒå‚æ•°**

| å‚æ•°        | ä½œç”¨                            |
| ----------- | ------------------------------- |
| Start Epoch | è¡¨ç¤ºepoch çš„å¼€å§‹ç¼–å·            |
| Epochs      | è¡¨ç¤ºè¿è¡Œçš„ epoch æ•°             |
| Workers     | è¡¨ç¤ºç”¨äºåŠ è½½æ•°æ®çš„å­è¿›ç¨‹æ•°é‡    |
| Batch Size  | è¡¨ç¤ºä¸€ä¸ªè®­ç»ƒ/éªŒè¯æ‰¹æ¬¡æ ·æœ¬çš„æ•°é‡ |



ğŸŒˆ**æ¨¡å‹å‚æ•°**

| å‚æ•°               | ä½œç”¨                     |
| ------------------ | ------------------------ |
| Momentum           | è¡¨ç¤º SGD çš„åŠ¨é‡å‚æ•°      |
| Model Architecture | è¡¨ç¤ºè®­ç»ƒæ—¶ä½¿ç”¨çš„æ¨¡å‹æ¶æ„ |
| Weight Decay       | æ§åˆ¶ SGD çš„æƒé‡è¡°å‡      |
| Loss Type          | è®­ç»ƒæ—¶ä½¿ç”¨çš„æŸå¤±å‡½æ•°ç±»åˆ« |
| Learning Rate      | SGD çš„å­¦ä¹ ç‡å‚æ•°         |



ğŸŒˆ**é€‰é¡¹**

| å‚æ•°                                                  | ä½œç”¨                         |
| ----------------------------------------------------- | ---------------------------- |
| save model(You can find it in 'Trained_model' folder) | ä¿å­˜æ¨¡å‹è‡³ â€./Trained_modelâ€œ |



ğŸŒˆ**è¾“å‡º**

è¾“å‡ºæ¯ä¸ª epoch ä¸Šåœ¨è®­ç»ƒé›† & æµ‹è¯•é›†ä¸Šçš„å››ä¸ª metric ä¸ŠæŠ˜çº¿å›¾

* precision&1 and GM
* HM & LR



#### (2). æ¨ç†

â˜€ï¸ä¸€ä¸ªç®€å•çš„åº”ç”¨æ¨¡å—ï¼Œè¿™å¹¶éæ˜¯æœ¬é¡¹ç›®çš„é‡ç‚¹ï¼Œæ‰€ä»¥ç•¥æ˜¾ç²—ç³™

* Image : ä¸Šä¼ å¾…åˆ†ç±»çš„å›¾ç‰‡
* Model Architecture : é€‰æ‹©ç”¨äºæ¨ç†çš„æ¨¡å‹æ¶æ„
* Load Model ï¼š åŠ è½½å·²ç»é¢„è®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œæ³¨æ„**è¯·ä¸æ¨¡å‹æ¶æ„ï¼Œä»¥åŠæ¨¡å‹åŸæœ¬çš„è®­ç»ƒé›†å¯¹åº”**
  * **æ¨¡å‹æ–‡ä»¶å¤¹ä¸º** "./Trained_model"
* Choose Raw Dataset : é€‰æ‹©é¢„è®­ç»ƒæ¨¡å‹æ‰€ä½¿ç”¨çš„æ•°æ®é›†
* Label : è¾“å‡ºæ¨ç†ç»“æœï¼Œå³åˆ†ç±»ç»“æœ



> Ex ï¼šæ•ˆæœè™½ç„¶å·®å¼ºäººæ„ï¼Œä½†æ˜¯åˆä¹æƒ…ç†

![img](./info.png)



#### (3). æ¯”è¾ƒ

âœ”ï¸è¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å®ç°äº†å°†é¢„è®­ç»ƒåœ¨é€‰å®šæ•°æ®é›†ä¸Šä½¿ç”¨æŒ‡å®šæŸå¤±å‡½æ•°è¿›è¡Œ `fine-tuning` çš„åŠŸèƒ½

* Dataset : ç”¨äº `fine-tuning` çš„æ•°æ®é›†



ğŸ’«**Imbalance è®¾ç½®**

| å‚æ•°             | ä½œç”¨                                                      |
| ---------------- | --------------------------------------------------------- |
| Imbalance Factor | #æ‰€å«æ ·æœ¬æœ€å°‘çš„ç±»åˆ«çš„æ ·æœ¬æ•° / #æ‰€å«æ ·æœ¬æœ€å¤šçš„ç±»åˆ«çš„æ ·æœ¬æ•° |
| Imbalance Type   | å°†å¹³è¡¡çš„cifar-10/cifar-100æ‰“ä¹±ä¸ºä¸å¹³è¡¡æ•°æ®é›†çš„æ–¹å¼        |



ğŸ’«**Model è®¾ç½®**

| å‚æ•°                    | ä½œç”¨                                               |
| ----------------------- | -------------------------------------------------- |
| Model Architecture      | é¢„è®­ç»ƒæ¨¡å‹çš„æ¶æ„                                   |
| Select Pretrained Model | ä» â€./models/pretrainedâ€œ ä¸­åŠ è½½é¢„å…ˆè®­ç»ƒæ¨¡å‹        |
| Loss Type for Tuning    | Fine-tuning ä½¿ç”¨çš„æŸå¤±å‡½æ•°ç±»å‹ï¼Œé»˜è®¤æ˜¯ä½œè€…çš„ "GML" |
| Epochs                  | Fine-tuning çš„è®­ç»ƒè®ºæ•°                             |

ğŸ’«**è¾“å‡º**

è¾“å‡ºä¸€ç»„æŸ±çŠ¶å›¾ï¼Œåˆ†ææ–°æ—§æ¨¡å‹åœ¨100(cifar100)/10(cifar10)ä¸ªç±»åˆ«ä¸Šçš„å‡†ç¡®ç‡



### 2.4 ç»†èŠ‚



â—**1. é¢„å¤„ç†æ¨¡å‹çš„å‚æ•°**

é¦–å…ˆï¼Œæˆ‘ä»¬çš„é¢„å¤„ç†æ¨¡å‹åªæ”¶é›†äº†ç½‘ç»œæ¶æ„çš„å‚æ•°ï¼Œå…¶æ¬¡æ‚¨å¦‚æœéœ€è¦åŠ è½½å¦å¤–çš„é¢„å¤„ç†æ¨¡å‹ï¼Œè¯·ç¡®ä¿ï¼š

* åŸå…ˆé¢„å¤„ç†æ¨¡å‹çš„è®­ç»ƒçš„ resnet ç½‘ç»œå’Œæœ¬é¡¹ç›®ä½¿ç”¨çš„ç½‘ç»œåŸºæœ¬ç›¸åŒ
* å…·ä½“é¢„å¤„ç†æ¨¡å‹çš„å‚æ•°éœ€è¦æœ‰ç±»ä¼¼ï¼š
  * conv1.weight
  * layer1.2.conv1.weight
  * layer2.4.bn1.running_var
  * linear.weight
  * linear.bias

> åœ¨æˆ‘ä»¬é¡¹ç›®æ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°æœ‰äº›æ¨¡å‹æ–‡ä»¶é‡Œé¢çš„å‚æ•°æ˜¯ module.conv1.weight æˆ– fc.biasï¼Œè¿™ä¸ä»£è¡¨è¯¥æ¨¡å‹æ— æ³•å’Œæœ¬é¡¹ç›®å¯¹åº”èµ·æ¥ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ”¹æ¨¡å‹æ–‡ä»¶çš„**é”®å€¼å¯¹**ï¼Œä»è€Œä½¿å¾—æ‚¨çš„æ¨¡å‹é€‚é…æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œ



â—**2. å…³äºè¿è¡Œè¯¥é¡¹ç›®è®¾å¤‡çš„è¯´æ˜**

æœ¬é¡¹ç›®å¤§éƒ¨åˆ†ä»£ç åœ¨ cpu è®¾å¤‡ä¸Šç¼–å†™ï¼Œå¹¶èƒ½å¤ŸæˆåŠŸè¿è½¬ï¼Œä½†æ˜¯è®­ç»ƒé€Ÿåº¦ååˆ†ç¼“æ…¢ï¼Œå¯ä»¥ç”¨äºç®€å•æ¨ç†ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†ä»“åº“åœ¨ gpu è®¾å¤‡ä¸Šè¿è¡Œå¹¶è°ƒæ•´ï¼Œä½¿å¾—å…¶ç°åœ¨åŸºæœ¬ä¸Šæ˜¯èƒ½åœ¨ä¸¤ç§è®¾å¤‡éƒ½å¯ä»¥è¿è½¬



â—**3. å…³äºä½¿ç”¨ colab / äº‘æœåŠ¡å™¨çš„è¯´æ˜**

å½“æ‚¨ä½¿ç”¨ colab ç­‰å†ç°è®­ç»ƒæ–¹å¼ï¼Œwebui åˆ™æ— æ³•æä¾›ç»™äºˆ pretrained æ¨¡å‹çš„é€‰é¡¹ï¼Œä½†å¯ä»¥æä¾›è®­ç»ƒæ¨¡å‹çš„æ¥å£ï¼Œè¾“å‡ºçš„ç»“æœå°†å­˜å‚¨åœ¨ `results` ä¸ `compare` æ–‡ä»¶å¤¹ä¸­


---


## 3. ä½¿ç”¨



â­•**ä½¿ç”¨ CE/BSCE/Focal/LaDe/FeaBal/LDAM æ–¹æ³•**

åªéœ€åœ¨ app.py ç”Ÿæˆçš„ webui ä¸Šä¿®æ”¹æŸå¤±å‡½æ•°ï¼Œå¹¶è°ƒæ•´å…¶ä»–å‚æ•°å³å¯ï¼Œå¦‚æœæ‚¨éœ€è¦æ›´è¯¦ç»†çš„è®­ç»ƒæƒ…å†µï¼Œå¯ä»¥æŸ¥çœ‹ â€./logâ€œ



â­•**ä½¿ç”¨ Paco æ–¹æ³•**

```markdown
cd ./Paco
```

ä½¿ç”¨ git bash æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ (3é€‰1)ï¼š

* `bash sh/CIFAR100_train_imb0.1.sh`
* `bash sh/CIFAR100_train_imb0.01.sh` (æ¨è)
* `bash sh/CIFAR100_train_imb0.02.sh`

å¦‚æœæ‚¨ç›´æ¥åœ¨ IDE è¿è¡Œ `paco_cifar.py` å°†ä¼šæ‰§è¡Œæˆ‘ä»¬è°ƒæ•´çš„é»˜è®¤é…ç½®ï¼Œå³ä½¿ç”¨ imb = 0.01 åœ¨CIFAR100 ä¸Šè¿è¡Œ

> æ¨èä½¿ç”¨ç¬¬äºŒæ¡å‘½ä»¤çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬å‡†å¤‡çš„é¢„è®­ç»ƒæ¨¡å‹è®­ç»ƒä½¿ç”¨çš„æ•°æ®é›† imb = 0.01



â­•**ä½¿ç”¨ Ride æ–¹æ³•** 

```
cd ./RIDE-LongTailRecognition
```

ç»ˆç«¯è¿è¡Œ(4 é€‰ 1)ï¼š

* `python train.py -c "configs/config_imbalance_cifar100_ride.json" -r "./pretrained/checkpoint-epoch5_ride.pth" --reduce_dimension 1 --num_experts 3`
* `python train.py -c "configs/config_imbalance_cifar100_ride_ea.json" -r "./pretrained/checkpoint-epoch5_ride_ea.pth" --reduce_dimension 1 --num_experts 3` (æ¨è)
* ``python train.py -c "configs/config_imbalance_cifar100_ride_teacher.json" -r "./pretrained/checkpoint-epoch200_ride_teacher.pth" --reduce_dimension 1 --num_experts 6``

> å¦‚æœï¼Œæ‚¨éœ€è¦æ›´æ”¹ epoch ç­‰å‚æ•°ï¼Œå¯ä»¥åœ¨ä¸Šè¿°å‘½ä»¤çš„ json æ–‡ä»¶ä¸­ä¿®æ”¹



## 4. å‚è€ƒ

* æœ¬é¡¹ç›®æ ¸å¿ƒä»£ç åŸºäº [FBL](https://github.com/juyongjiang/fbl)
* Paco æ¥è‡ªä»“åº“ [Parametric-Contrastive-Learning](https://github.com/dvlab-research/Parametric-Contrastive-Learning)ï¼ŒRide æ¥è‡ªä»“åº“ [RIDE-LongTailRecognition](https://github.com/frank-xwang/RIDE-LongTailRecognition)



